local smtp = require"socket.smtp"
require"yaci"

SimpleSender = newclass("SimpleSender")

function SimpleSender:init(to, from)
	 self.from =  from
	 self.to = to
end

function SimpleSender:formatAdress(ad)
	 assert(type(ad) == 'string)

	 local mail = ad:gmatch("<[A-Za-z0-9%.%%%+%-]+@[A-Za-z0-9%.%%%+%-]+%.%w%w%w?%w?>")

	 if not mail then
	    return nil, "malformed email-address"
	 end

	 return mail	   
end

function SimpleSender:send(from, to)
	 local sfrom = from or self.from
	 local sto = to or self.to

	 assert(sfrom)
	 assert(sto)

	 local tfrom = {}
	 
end

from = "<onkeljojo@onkel.jojo>"

rcpt = {
  "<jost.degenhardt@googlemail.com>",
  "<porschekoenig@googlemail.com>",
  "<jhdfkhskfhshfkhfkhfhhshkfkd@googlemail.com>"
}

mesgt = {
  headers = {
    to = "Jost Degenhardt <jost.degenhardt@googlemail.com",
    cc = '<jhdfkhskfhshfkhfkhfhhshkfkd@googlemail.com>',
    subject = "Lua test"
  },
  body = "Hallohallo!"
}

r, e = smtp.send{
  from = from,
  rcpt = rcpt, 
  source = smtp.message(mesgt)
}
